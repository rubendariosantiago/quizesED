<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Examen de Ecuaciones Diferenciales Parametrizadas</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    .question { background: #f9f9f9; padding: 15px; margin: 20px 0; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    .feedback { margin-top: 10px; padding: 10px; border-radius: 5px; }
    .correct { background: #e6f7e6; border-left: 4px solid #4CAF50; }
    .incorrect { background: #ffebee; border-left: 4px solid #f44336; }
    button { background: #4CAF50; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; margin-top: 10px; }
    #result { font-size: 18px; margin: 20px 0; padding: 15px; text-align: center; }
    .hidden { display: none; }
    input[type="text"] { width: 100%; padding: 8px; margin-top: 5px; }
  </style>
</head>
<body>

<h1>Examen de Ecuaciones Diferenciales</h1>
<div id="quiz"></div>
<button onclick="submitExam()">Enviar Examen</button>
<div id="result" class="hidden"></div>

<script>
// ---------------------- CONFIGURACI√ìN ----------------------
const TOLERANCIA = 1e-2;  // Tolerancia para el error cuadr√°tico medio

// ---------------------- GENERADOR DE COEFICIENTES ----------------------
function randNonZero(min, max) {
  let num;
  do {
    num = Math.floor(Math.random() * (max - min + 1)) + min;
  } while (num === 0 || num === 1 || num === -1);
  return num;
}

function randCoeff() {
  return randNonZero(2, 5) ;
}

function randInitial() {
  return Math.floor(Math.random() * 7) - 3;  // d ‚àà [-3, 3]
}

// ---------------------- GENERADOR DE ECUACIONES ----------------------
function generateEDO() {
  const a = randCoeff();
  const b = randCoeff();
  const c = randCoeff();
  const d = randInitial();
  const x0 = 0;

  const type = Math.floor(Math.random() * 6) + 1;  // 6 tipos
  let question, solution;

  switch (type) {
    case 1:  // y' + a*y = b
      question = `Resuelve: \\( y' + ${a}y = ${b} \\), \\( y(${x0}) = ${d} \\)`;
      solution = `${b}/${a} + ${d - b/a}*exp(-${a}*x)`;
      break;
    case 2:  // y' + a*y = b*x
      question = `Resuelve: \\( y' + ${a}y = ${b}x \\), \\( y(${x0}) = ${d} \\)`;
      solution = `${b}/${a}*x - ${b/(a*a)} + ${d + b/(a*a)}*exp(-${a}*x)`;
      break;
    case 3:  // y' + a*y = b*exp(c*x), a ‚â† -c
      question = `Resuelve: \\( y' + ${a}y = ${b}e^{${c}x} \\), \\( y(${x0}) = ${d} \\)`;
      solution = `${b/(a + c)}*exp(${c}*x) + ${d - b/(a + c)}*exp(-${a}*x)`;
      break;
    case 4:  // y' + a*y = b*cos(c*x)
      question = `Resuelve: \\( y' + ${a}y = ${b}\\cos(${c}x) \\), \\( y(${x0}) = ${d} \\)`;
      solution = `${b/(a*a + c*c)}*(${a}*cos(${c}x) + ${c}*sin(${c}x)) + ${d - (a*b)/(a*a + c*c)}*exp(-${a}*x)`;
      break;
    case 5:  // y' + a*y = b*sin(c*x)
      question = `Resuelve: \\( y' + ${a}y = ${b}\\sin(${c}x) \\), \\( y(${x0}) = ${d} \\)`;
      solution = `${b/(a*a + c*c)}*(${a}*sin(${c}x) - ${c}*cos(${c}x)) + ${d + (c*b)/(a*a + c*c)}*exp(-${a}*x)`;
      break;
    case 6:  // y' + a*y = b*exp(-a*x)
      question = `Resuelve: \\( y' + ${a}y = ${b}e^{-${a}x} \\), \\( y(${x0}) = ${d} \\)`;
      solution = `${d}*exp(-${a}*x) + ${b}*x*exp(-${a}*x)`;
      break;
  }

  return { question, solution, type };
}

// ---------------------- EVALUADOR NUM√âRICO (ECM) ----------------------
function evaluateSolution(userExpr, correctExpr) {
  try {
    let errors = [];
    for (let i = 0; i < 10; i++) {
      const x = math.random(0.1, 3);  // Evitar x=0 para divisiones
      const yUser = math.evaluate(userExpr, { x });
      const yCorrect = math.evaluate(correctExpr, { x });
      errors.push(math.pow(yUser - yCorrect, 2));
    }
    return math.mean(errors) < TOLERANCIA;
  } catch (error) {
    return false;
  }
}

// ---------------------- RENDERIZAR EXAMEN ----------------------
function renderExam() {
  const quizContainer = document.getElementById('quiz');
  quizContainer.innerHTML = '';

  // Generar 3 ejercicios aleatorios sin repetir tipo
  const usedTypes = [];
  while (usedTypes.length < 3) {
    const edo = generateEDO();
    if (!usedTypes.includes(edo.type)) {
      usedTypes.push(edo.type);
      quizContainer.innerHTML += `
        <div class="question" data-type="${edo.type}" data-solution="${edo.solution.replace(/\*/g, '')}">
          <p><strong>Ejercicio ${usedTypes.length}:</strong> ${edo.question}</p>
          <input type="text" placeholder="Ingresa y(x)..." class="answer-input">
          <div class="feedback hidden"></div>
        </div>
      `;
    }
  }
}

// ---------------------- ENVIAR EXAMEN ----------------------
function submitExam() {
  let score = 0;
  const questions = document.querySelectorAll('.question');

  questions.forEach((q, i) => {
    const userAnswer = q.querySelector('.answer-input').value;
    const correctAnswer = q.dataset.solution;
    const feedback = q.querySelector('.feedback');

    if (evaluateSolution(userAnswer, correctAnswer)) {
      feedback.innerHTML = '‚úÖ Correcto!';
      feedback.className = 'feedback correct';
      score++;
    } else {
      feedback.innerHTML = `‚ùå Incorrecto. Soluci√≥n: \\( ${correctAnswer} \\)`;
      feedback.className = 'feedback incorrect';
    }
    feedback.classList.remove('hidden');
  });

  // Mostrar resultado
  const resultDiv = document.getElementById('result');
  resultDiv.innerHTML = `
    <h3>Resultado: ${score}/${questions.length}</h3>
    ${score === questions.length ? 'üéâ ¬°Perfecto!' : 'üí° ¬°Sigue practicando!'}
  `;
  resultDiv.classList.remove('hidden');

  // Renderizar MathJax (para las soluciones)
  if (window.MathJax) {
    MathJax.typeset();
  }
}

// Iniciar examen
renderExam();
</script>
</body>
</html>
