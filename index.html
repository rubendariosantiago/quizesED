<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Examen Dinámico</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <div id="quiz"></div>
  <button id="submit">Enviar</button>

  <script>
    // ---------------------- CARGAR BANCOS DE PREGUNTAS ----------------------
    let theoryQuestions = [];
    let practicalTemplates = [];

    async function loadQuestions() {
      // Cargar preguntas teóricas
      const teorica = await fetch('questions/teorica.json');
      theoryQuestions = await teorica.json();
      
      // Cargar plantillas prácticas
      const practica = await fetch('questions/practica.json');
      practicalTemplates = await practica.json();
      
      renderExam();
    }

    // ---------------------- GENERADOR DE PARÁMETROS ----------------------
    function randParam(config) {
      let num;
      do {
        num = Math.floor(Math.random() * (config.max - config.min + 1)) + config.min;
      } while (config.nonZero && num === 0);
      return num;
    }

    // ---------------------- RENDERIZAR EXAMEN ----------------------
    function renderExam() {
      const quizContainer = document.getElementById('quiz');
      quizContainer.innerHTML = '';

      // 1. Preguntas teóricas (aleatorizar orden de opciones)
      theoryQuestions.forEach((q, i) => {
        const shuffledOptions = [...q.options].sort(() => Math.random() - 0.5);
        const correctIndex = shuffledOptions.indexOf(q.options[q.answer]);
        
        quizContainer.innerHTML += `
          <div class="question" data-type="theory" data-answer="${correctIndex}">
            <p>${q.question}</p>
            ${shuffledOptions.map((opt, idx) => `
              <label><input type="radio" name="theory-${i}" value="${idx}"> ${opt}</label><br>
            `).join('')}
          </div>
        `;
      });

      // 2. Ejercicios prácticos (generados dinámicamente)
      practicalTemplates.slice(0, 3).forEach((template, i) => {
        const params = {};
        Object.keys(template.params).forEach(key => {
          params[key] = randParam(template.params[key]);
        });

        let question = template.template;
        let solution = template.solution;
        let steps = template.steps;

        // Reemplazar placeholders ({{a}}, {{b}}, etc.)
        Object.keys(params).forEach(key => {
          const regex = new RegExp(`\\{\\{${key}\\}\\}`, 'g');
          question = question.replace(regex, params[key]);
          solution = solution.replace(regex, params[key]);
          steps = steps.map(step => step.replace(regex, params[key]));
        });

        quizContainer.innerHTML += `
          <div class="question" data-type="practical" data-solution="${solution}">
            <p>${question}</p>
            <input type="text">
            <div class="solution-steps hidden">${steps.join('<br>')}</div>
          </div>
        `;
      });
    }

    // Cargar todo al iniciar
    loadQuestions();
  </script>
</body>
</html>
